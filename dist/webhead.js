function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var r=e(require("cheerio")),t=e(require("fs-extra")),n=e(require("node-libcurl")),o=e(require("jquery-param"));function a(){return(a=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}var i=e(require("tough-cookie")).CookieJar,s=n.curly;module.exports=function(e){var n,u=e||{},c=u.jarFile,l=u.userAgent,d=u.verbose,f={},p=function e(r,t,n){try{return r=r.toUpperCase(),t=y(t),n=n||{},Promise.resolve(h(r,t,n)).then(function(r){var n=r.response,o=r.redirect;return o?e(o.method,o.url,o.options):(f.url=t,f.cookie=m(t),f.$=C(n),f.response=n,n)})}catch(e){return Promise.reject(e)}},h=function(e,r,o){try{var a=v(r),i=j(e,r,o),u=i.curl,l=i.opts;return d&&console.debug(e,u,l),Promise.resolve(s[e.toLowerCase()](u,l)).then(function(r){var i;if(r.headers=g(r.headers[0]),d&&console.debug(r),r.headers["Set-Cookie"]&&(r.headers["Set-Cookie"].forEach(function(e){n.setCookieSync(e,a)}),c)){var s=n.toJSON().cookies;t.writeFileSync(c,JSON.stringify(s,null,2))}return/^3/.test(""+r.statusCode)&&(i={method:e,url:r.headers.Location,options:o},r.statusCode<=303&&(i.method="GET",delete i.options.data)),{response:r,redirect:i}})}catch(e){return Promise.reject(e)}},m=function(e){return n.getCookiesSync(v(e)).join("; ")},v=function(e){return e.href.replace(/\?.*/,"")},y=function(e){return f.url&&e.match(/^\//)&&(e=f.url.origin+e),new URL(e)},g=function(e){return e?Object.entries(e).reduce(function(e,r){var t=r[1];return e[r[0].replace(/\b./g,function(e){return e.toUpperCase()})]=t,e},{}):{}},j=function(e,r,t){var n=t.headers,a=t.data,i=r.href,s={},u=m(r);return(n=g(n)).Host=r.host,u.length&&(n.Cookie=u),!n["User-Agent"]&&l&&(n["User-Agent"]=l),a&&(a=o(a),"GET"==e?i+=(i.match(/\?/)?"&":"?")+a:s.postFields=a,n["Content-Type"]||(n["Content-Type"]="application/x-www-form-urlencoded")),s.httpHeader=Object.entries(n).map(function(e){return e.join(": ")}),{curl:i,opts:s}},C=function(e){var t=e.headers,n=e.data;if(/^2/.test(""+e.statusCode)){var o=t["Content-Type"];if(o.match("html"))return r.load(n);if(o.match("xml"))return r.load(n,{xmlMode:!0})}};return"get post put delete head patch".split(" ").forEach(function(e){f[e]=function(){try{var r=arguments;return Promise.resolve(p.apply(void 0,[e].concat([].slice.call(r))))}catch(e){return Promise.reject(e)}}}),f.submit=function(e,r,t){try{var n=f.$(e);return Promise.resolve(function(){if(n.length){var e=n.attr("action"),o=n.attr("method")||"GET";return r=Object.assign(n.serializeArray().reduce(function(e,r){return e[r.name]=r.value,e},{}),r||{}),Promise.resolve(p(o,e,a({},t,{data:r})))}}())}catch(e){return Promise.reject(e)}},f.text=function(){return f.response.data},f.json=function(){if(f.response.data&&f.response.headers["Content-Type"].toString().match("json"))return JSON.parse(f.response.data)},n=t.pathExistsSync(c)?i.fromJSON({cookies:t.readJsonSync(c)}):new i,f};
//# sourceMappingURL=webhead.js.map
