function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var r=e(require("cheerio")),t=e(require("form-data")),o=e(require("fs-extra")),n=e(require("node-fetch")),a=e(require("jquery-param"));function s(){return(s=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(this,arguments)}var i=e(require("tough-cookie")).CookieJar;module.exports=function(e){var c,u,d,l=e||{},h=l.jarFile,f=l.userAgent,p=l.verbose,m=l.beforeSend,v=l.complete,y={},j={},g=function e(r,t,o){try{var n={method:r.toUpperCase(),url:C(t),options:S(o)};return m&&((n=m(n,j)).method=n.method.toUpperCase(),n.url=C(n.url),n.options=S(n.options)),Promise.resolve(b(n)).then(function(r){var t=r.response,o=r.redirect;return o?e(o.method,o.url,o.options):(y.url=n.url,y.cookie=w(y.url.href),y.response=t,v&&v(n,j,y),t)})}catch(e){return Promise.reject(e)}},C=function(e){return e.constructor==URL&&(e=e.href),y.url&&e.match(/^\//)&&(e=y.url.origin+e),new URL(e)},S=function(e){return e||(e={}),e.headers=P(e.headers),e},P=function(e){return e?Object.entries(e).reduce(function(e,r){var t=r[0],o=r[1];return"set-cookie"!=t.toLowerCase()&&Array.isArray(o)&&(o=o.join("; ")),e[t.replace(/\b./g,function(e){return e.toUpperCase()})]=o,e},{}):{}},b=function(e){var r=e.method,i=e.url,c=e.options;try{var u=c.headers,d=c.data,l=c.multiPartData,h=c.json,m=w(i.href),v={method:r,headers:Object.assign({},u),redirect:"manual"};if(v.headers.Host=i.host,i=i.href,m.length&&(v.headers.Cookie=m),!v.headers["User-Agent"]&&f&&(v.headers["User-Agent"]=f),d)"GET"==r?i+=(i.match(/\?/)?"&":"?")+a(d):(v.headers["Content-Type"]||(v.headers["Content-Type"]="application/x-www-form-urlencoded"),v.body=a(d));else if(l){var y=new t;(l||[]).forEach(function(e){y.append(e.name,e.file?o.createReadStream(e.file):e.hasOwnProperty("value")?e.value:e.contents)}),v.body=y,v.headers=s({},v.headers,y.getHeaders())}return h&&(v.headers["Content-Type"]="application/json",v.body=JSON.stringify(h)),p&&console.log(r,i,v),Promise.resolve(n(i,s({method:r},v))).then(function(e){return Promise.resolve(k(r,i,c,e))})}catch(e){return Promise.reject(e)}},k=function(e,r,t,n){try{var a=n.status;return Promise.resolve(n.text()).then(function(s){var i,l=P(n.headers.raw());if(p&&console.log({statusCode:a,data:s,headers:l}),l["Set-Cookie"]){var f=O(r);if(l["Set-Cookie"].forEach(function(e){c.setCookieSync(e,f)}),h){var m=c.toJSON().cookies,v={};o.pathExistsSync(h)&&(v=o.readJsonSync(h)),v.constructor==Object?v.cookies=m:v=m,o.writeFileSync(h,JSON.stringify(v,null,2))}}return/^3/.test(""+a)&&(i={method:e,url:l.Location,options:t},a<=303&&(i.method="GET",delete i.options.data)),u=void 0,d=void 0,{response:{statusCode:a,data:s,headers:l},redirect:i}})}catch(e){return Promise.reject(e)}},O=function(e){return e.replace(/\?.*/,"")},w=function(e){return c.getCookiesSync(O(e)).join("; ")};if("get post put patch delete head options".split(" ").forEach(function(e){y[e]=function(){try{var r=arguments;return Promise.resolve(g.apply(void 0,[e].concat([].slice.call(r))))}catch(e){return Promise.reject(e)}}}),y.text=function(){return y.response?y.response.data:""},y.json=function(){if(!d&&y.response){var e=y.response,r=e.data;r&&(""+e.headers["Content-Type"]).match("json")&&(d=JSON.parse(r))}return d},y.$=function(){if(!u&&y.response){var e=y.response,t=e.data,o=e.headers,n=(""+o["Content-Type"]).match(/(html|xml)/);n&&(u=r.load(t,{xmlMode:"xml"==n[1]}))}return u?u.apply(void 0,[].slice.call(arguments)):[]},y.submit=function(e,r,t){try{var o=y.$(e);return Promise.resolve(function(){if(o.length){var e=o.attr("action"),n=o.attr("method")||"GET";return r=Object.assign(o.serializeArray().reduce(function(e,r){return e[r.name]=r.value,e},{}),r||{}),Promise.resolve(g(n,e,s({},t,{data:r})))}}())}catch(e){return Promise.reject(e)}},o.pathExistsSync(h)){var x=o.readJsonSync(h),E=x.cookies||x;c=i.fromJSON({cookies:E.constructor==Array?E:[]})}else c=new i;return y};
//# sourceMappingURL=webhead.js.map
