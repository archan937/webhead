function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var r=e(require("cheerio")),t=e(require("fs-extra")),n=e(require("node-libcurl")),o=e(require("querystring"));function i(){return(i=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}var a=e(require("tough-cookie")).CookieJar,s=n.curly;module.exports=function(e){var n,u=e||{},c=u.jarFile,l=u.userAgent,f=u.verbose,p={},d=function e(r,t,n){try{return r=r.toUpperCase(),t=y(t),n=n||{},Promise.resolve(h(r,t,n)).then(function(r){var n=r.response,o=r.redirect;return o?e(o.method,o.url,o.options):(p.url=t,p.cookie=m(t),p.$=j(n),p.response=n,n)})}catch(e){return Promise.reject(e)}},h=function(e,r,o){try{var i=v(r),a=C(e,r,o),u=a.curl,l=a.opts;return f&&console.debug(e,u,l),Promise.resolve(s[e.toLowerCase()](u,l)).then(function(r){var a;if(r.headers=g(r.headers[0]),f&&console.debug(r),r.headers["Set-Cookie"]&&(r.headers["Set-Cookie"].forEach(function(e){n.setCookieSync(e,i)}),c)){var s=n.toJSON().cookies;t.writeFileSync(c,JSON.stringify(s,null,2))}return/^3/.test(""+r.statusCode)&&(a={method:e,url:r.headers.Location,options:o},r.statusCode<=303&&(a.method="GET",delete a.options.formData)),{response:r,redirect:a}})}catch(e){return Promise.reject(e)}},m=function(e){return n.getCookiesSync(v(e)).join("; ")},v=function(e){return e.href.replace(/\?.*/,"")},y=function(e){return p.url&&e.match(/^\//)&&(e=p.url.origin+e),new URL(e)},g=function(e){return e?Object.entries(e).reduce(function(e,r){var t=r[1];return e[r[0].replace(/\b./g,function(e){return e.toUpperCase()})]=t,e},{}):{}},C=function(e,r,t){var n=t.headers,i=t.formData,a=r.href,s={},u=m(r);return(n=g(n)).Host=r.host,u.length&&(n.Cookie=u),!n["User-Agent"]&&l&&(n["User-Agent"]=l),i&&(i=o.stringify(i),"GET"==e?a+=(a.match(/\?/)?"&":"?")+i:s.postFields=i,n["Content-Type"]||(n["Content-Type"]="application/x-www-form-urlencoded")),s.httpHeader=Object.entries(n).map(function(e){return e.join(": ")}),{curl:a,opts:s}},j=function(e){var t=e.headers,n=e.data;if(/^2/.test(""+e.statusCode)){var o=t["Content-Type"];if(o.match("html"))return r.load(n);if(o.match("xml"))return r.load(n,{xmlMode:!0})}};return"get post put delete head patch".split(" ").forEach(function(e){p[e]=function(){try{var r=arguments;return Promise.resolve(d.apply(void 0,[e].concat([].slice.call(r))))}catch(e){return Promise.reject(e)}}}),p.submit=function(e,r,t){try{var n=p.$(e);return Promise.resolve(function(){if(n.length){var e=n.attr("action"),o=n.attr("method")||"GET",a=Object.assign(n.serializeArray().reduce(function(e,r){return e[r.name]=r.value,e},{}),r||{});return Promise.resolve(d(o,e,i({},t,{formData:a})))}}())}catch(e){return Promise.reject(e)}},p.text=function(){return p.response.data},p.json=function(){if(p.response.data&&p.response.headers["Content-Type"].toString().match("json"))return JSON.parse(p.response.data)},n=t.pathExistsSync(c)?a.fromJSON({cookies:t.readJsonSync(c)}):new a,p};
//# sourceMappingURL=webhead.js.map
